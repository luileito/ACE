/*
 * ACE: An Adaptive CSS Engine for Web Pages and Web-based Applications.
 * Luis A. Leiva. In Proc. WWW Dev Track, 2012.
 * Released under the MIT license: http://www.opensource.org/licenses/MIT
 */
(function(e,f){var a={};var c={};var b=0;var g={findElement:function(m){m=m||e.event;var l=m.target||m.srcElement;if(l.nodeType==3){l=l.parentNode}return d.getXPath(l)},updateRank:function(m){m=m||e.event;var l=this.findElement(m);if(!c[l]){c[l]={}}if(!c[l][m.type]){c[l][m.type]=0}c[l][m.type]++;b++},saveRank:function(){var l=g.fuseRank(c);var m=g.diffRank(l,a);j.set("ace-rank",JSON.stringify(m))},fuseRank:function(r){var q={},v,x,u,m;var s=0;for(var l in k.config.priorities){s+=k.config.priorities[l]}for(var o in r){v=r[o];x=m=0;for(var t in v){u=k.config.priorities[t]/s;x+=v[t]*u;m++}q[o]=g.sigmoid(x/b,m)}return q},sigmoid:function(l,m){m=m||1;return this.sinh(l*m)},sinh:function(m){var l=Math.exp(m);return(l-1/l)/2},tanh:function(l){return 1-2/(Math.exp(2*l)+1)},diffRank:function(o,l){var p={};var n;for(var m in o){n=o[m];if(l&&l[m]){n-=l[m]}p[m]=n}return p},restyle:function(o,p,q){var m=this.getStyle(o,p);if(!m){return}var l="";if(/color/.test(p)){var n=this.parseColor(m);l=this.cssColorAdapt(n,q)}else{if(/[0-9]+/.test(m)){var r=this.parseDimension(m);l=this.cssDimensionAdapt(r.value,q)+r.unit}else{l=m}}this.setStyle(o,p,l)},cssDimensionAdapt:function(m,l){var n=1+l;return(m>0?m*n:n)},getStyle:function(m,n){var l="";n=n.toLowerCase();if(e.getComputedStyle){l=e.getComputedStyle(m,null).getPropertyValue(n)}else{if(m.currentStyle){n=this.dash2camel(n);l=m.currentStyle[n]}}return l},setStyle:function(m,n,l){n=n.toLowerCase();if(m.style.setProperty){m.style.setProperty(n,l,"important")}else{if(style.setAttribute){n=this.dash2camel(n);m.style.setAttribute(n,l)}}},dash2camel:function(l){return l.replace(/\-(\w)/g,function(m,n){return n.toUpperCase()})},rgb2hex:function(m){var o=m[0].toString(16);if(o.length<2){o+=o}var n=m[1].toString(16);if(n.length<2){n+=n}var l=m[2].toString(16);if(l.length<2){l+=l}return o+n+l},rgb2dec:function(l){return parseInt(this.rgb2hex(l),16)},cssColor:function(l){var n=Math.floor(l).toString(16);for(var m=n.length;m<6;++m){n="0"+n}return"#"+n.toUpperCase()},cssColorAdapt:function(p,n){var u=this.rgbBrightness(p);var m=this.cssDimensionAdapt(u,n);var l,o,s,t;var q=p[0]+p[1]+p[2];if(u>m){t=(q-m)%255;l=p[0]-t;if(l<0){l=0}o=p[1]-t;if(o<0){o=0}s=p[2]-t;if(s<0){s=0}}else{t=(m-u)%255;l=p[0]+t;if(l>255){l=255}o=p[1]+t;if(o>255){o=255}s=p[2]+t;if(s>255){s=255}}return this.cssColor(this.rgb2dec([l,o,s]))},rgbBrightness:function(l){return(l[0]*299+l[1]*587+l[2]*114)/1000},rgbDifference:function(n,l){var m=(Math.max(n[0],l[0])-Math.min(n[0],l[0]))+(Math.max(n[1],l[1])-Math.min(n[1],l[1]))+(Math.max(n[2],l[2])-Math.min(n[2],l[2]));return Math.abs(Math.round(m))},parseColor:function(o){var s=[];if(o[0]=="r"){var m=o.indexOf("(");var t=o.indexOf(")");o=o.substring(m+1,t);s=o.split(",");for(var q=0;q<3;++q){s[q]=parseInt(s[q])}}else{if(o[0]=="#"){var l=1;var p=o.length<6?1:2;for(var r=0,n="";r<3;++r){n=o.substr(l,p);if(p==1){n+=n}s[r]=parseInt(n,16);l+=p}}}return s},parseDimension:function(n){var l=parseFloat(n);var m=n.split(l);return{value:l,unit:m[1]}}};var d={queryXPath:function(l,n){var m;if(typeof l.evaluate==="function"){m=l.evaluate(n,l.documentElement,null,XPathResult.ANY_TYPE,null)}else{try{l.setProperty("SelectionLanguage","XPath");m=l.selectNodes(n)}catch(o){m=false}}return m},getXPathNodes:function(m,o){var n=this.queryXPath(m,o);var l=[];var p=n.iterateNext();while(p){l.push(p);p=n.iterateNext()}return l},getXPath:function(r){var p=(r.ownerDocument instanceof HTMLDocument);var o=this.getNodePath(r);var n=[];for(var m in o){var s;var q=o[m];if(q.nodeType==1){if(m==0&&q.hasAttribute("id")){n.push("/*[@id='"+q.getAttribute("id")+"']")}else{var l=q.tagName;if(p){l=l.toLowerCase()}s=this.getNodeIndex(q);if(s!=null){n.push(l+"["+s+"]")}else{n.push(l)}}}else{if(q.nodeType==3){s=this.getTextNodeIndex(q);if(s!=null){n.push("text()["+s+"]")}else{n.push("text()")}}}}return"/"+n.join("/")},getNodeIndex:function(m){if(m.nodeType!=1||m.parentNode==null){return null}var n=this.getChildNodesWithTagName(m.parentNode,m.tagName);if(n.length==1&&n[0]==m){return null}for(var l=0;l<n.length;l++){if(n[l]==m){return l+1}}throw"couldn't find node in parent's list: "+m.tagName},getTextNodeIndex:function(m){var n=this.getChildTextNodes(m.parentNode);if(n.length==1&&n[0]==m){return null}for(var l=0;l<n.length;l++){if(n[l]==m){return l+1}}throw"couldn't find node in parent's list: "+m.tagName},getChildNodesWithTagName:function(n,m){var l=[];var o=n.firstChild;while(o!=null){if(o.tagName&&o.tagName==m){l.push(o)}o=o.nextSibling}return l},getChildTextNodes:function(m){var l=[];var n=m.firstChild;while(n!=null){if(n.nodeType==3){l.push(n)}n=n.nextSibling}return l},getNodePath:function(m){var l=[];while(m.nodeType==1||m.nodeType==3){l.unshift(m);if(m.nodeType==1&&m.hasAttribute("id")){return l}m=m.parentNode}return l},getNodeValues:function(m){var l=[];for(var n in m){l.push(m[n].nodeValue)}return l}};var i={set:function(p,q,l,n,r){n=n||"/";r="; secure"||"";var m="";if(l){var o=new Date();o.setTime(o.getTime()+(l*24*60*60*1000));m="; expires="+o.toGMTString()}f.cookie=p+"="+escape(q)+m+"; path="+n},get:function(l){var m,n;if(f.cookie.length>0){m=f.cookie.indexOf(l+"=");if(m!=-1){m=m+l.length+1;n=f.cookie.indexOf(";",m);if(n==-1){n=f.cookie.length}return unescape(f.cookie.substring(m,n))}}return false},del:function(l){if(this.get(l)){this.set(l,null,-1)}}};var k={add:function(n,m,l){if(n.addEventListener){n.addEventListener(m,l,false)}else{if(n.attachEvent){n["e"+m+l]=l;n[m+l]=function(){n["e"+m+l](e.event)};n.attachEvent("on"+m,n[m+l])}}},remove:function(n,m,l){if(n.removeEventListener){n.removeEventListener(m,l,false)}else{if(n.detachEvent){n.detachEvent("on"+m,n[m+l]);n[m+l]=null}}},mouseHandler:function(l){g.updateRank(l)},keyHandler:function(l){g.updateRank(l)},winHandler:function(l){g.updateRank(l)},touchHandler:function(l){var m=l.touches[0]||l.targetTouches[0];switch(l.type){case"touchstart":case"touchmove":case"touchend":k.remove(f,l.type,k.mouseHandler);k.mouseHandler(m);break;default:return}},config:{priorities:{},defaults:true},init:function(l,n,m){if(n in this.config.priorities&&this.config.priorities[n]>0){this.add(l,n,m)}else{if(this.config.defaults&&typeof this.config.priorities[n]==="undefined"){this.config.priorities[n]=1;this.add(l,n,m)}}},initAll:function(p){var m=["mousedown","mouseup","mousemove","click","scroll","mousewheel"],r=["touchstart","touchend","touchmove"],n=["keydown","keyup","keypress"],l=["blur","focus","resize"],o,q;for(o=0;o<m.length;++o){this.init(p,m[o],k.mouseHandler)}for(o=0;o<r.length;++o){this.init(p,r[o],k.touchHandler)}for(o=0;o<n.length;++o){this.init(p,n[o],k.keyHandler)}for(o=0;o<l.length;++o){this.init(p,n[o],k.winHandler)}}};var j={size:function(){if(e.localStorage){return localStorage.length}else{var m=0;for(var n=0;n<f.cookie.length;++n){m+=f.cookie[n].length}return m}},set:function(l,m){if(e.localStorage){localStorage[l]=m}else{i.set(l,m)}},get:function(l){var m=false;if(e.localStorage){m=localStorage[l]}else{m=i.get(l)}return m},del:function(l){this.set(l,null)}};var h={listen:function(l,m){k.config.priorities=l;if(typeof m!=="undefined"){k.config.defaults=m}return this},adapt:function(p,l){l=l||f;a=j.get("ace-rank");if(a){a=JSON.parse(a)}for(var r in p){var x=l.querySelectorAll(r);var y=p[r];var v,w;for(var u=0,o=x.length;u<o;++u){v=d.getXPath(x[u]);for(var t=0,q=y.length;t<q;++t){if(a&&v in a){w=a[v];g.restyle(x[u],y[t],w)}}k.initAll(x[u])}}var s=(typeof l.onbeforeunload==="function")?"beforeunload":"unload";k.add(e,s,g.saveRank);return this}};e.ACE=h})(this,this.document);